<%- include("partials/head.ejs") %>
<link rel="stylesheet" href="/css/subscription.css">
<%- include("partials/header.ejs") %>

<main class="subscription-form-page">
    <div class="subscription-form-container">
        <h1><%= subscription ? 'Edit Subscription' : 'New Subscription' %></h1>
        <form action="<%= subscription ? '/subscriptions/update/' + subscription._id : '/subscriptions' %>" method="post">
            <input type="hidden" name="_csrf" value="<%= _csrf %>">
            <div class="input-group">
                <label for="company">Company:</label>
                <input type="text" id="company" name="company" value="<%= subscription ? subscription.company : '' %>" required>
            </div>
            <div class="input-group">
                <label for="dueDate">Due Date:</label>
                <input type="date" id="dueDate" name="dueDate" value="<%= subscription ? moment(subscription.dueDate).format('YYYY-MM-DD') : '' %>" required>
            </div>
            <div class="input-group">
                <label for="monthlyPayment">Monthly Payment:</label>
                <input type="number" id="monthlyPayment" name="monthlyPayment" value="<%= subscription ? subscription.monthlyPayment : '' %>" required>
            </div>
            <div class="input-group">
                <label for="status">Status:</label>
                <select id="status" name="status">
                    <option value="free trial" <%= subscription && subscription.status === 'free trial' ? 'selected' : '' %>>Free Trial</option>
                    <option value="active" <%= subscription && subscription.status === 'active' ? 'selected' : '' %>>Active</option>
                    <option value="canceled" <%= subscription && subscription.status === 'canceled' ? 'selected' : '' %>>Canceled</option>
                </select>
            </div>
            <div class="input-group">
                <label for="category">Category:</label>
                <select id="category" name="category">
                    <option value="Entertainment & Leisure" <%= subscription && subscription.category === 'Entertainment & Leisure' ? 'selected' : '' %>>Entertainment & Leisure</option>
                    <option value="Health & Fitness" <%= subscription && subscription.category === 'Health & Fitness' ? 'selected' : '' %>>Health & Fitness</option>
                    <option value="Finance" <%= subscription && subscription.category === 'Finance' ? 'selected' : '' %>>Finance</option>
                    <option value="Food" <%= subscription && subscription.category === 'Food' ? 'selected' : '' %>>Food</option>
                    <option value="Clothing" <%= subscription && subscription.category === 'Clothing' ? 'selected' : '' %>>Clothing</option>
                </select>
            </div>
            <div class="input-group">
                <label for="email">Notification Email:</label>
                <input type="email" id="email" name="email" value="<%= subscription ? subscription.email : req.user.email %>" required>
            </div>
            <div class="button-group">
                <button type="submit" class="btn btn-primary"><%= subscription ? 'Update Subscription' : 'Create Subscription' %></button>
                <a href="/subscriptions" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</main>

<%- include("partials/footer.ejs") %>
